{% extends 'base.html.twig' %}
{% block title %}TODOLIST{% endblock %}
{% block stylesheets %}
<link rel="stylesheet" href="/css/accueil.css">
<link rel="stylesheet" href="/css/mdb.min.css">
{% endblock %}
{% block body %}
<header>
  {# NAVBAR #}
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <a class="navbar-brand" href="/accueil">
      <img src="../img/logo_transpa.png" width="30" height="30" alt="logo" id="logo">
    </a>
    <form class="form-inline my-2 my-lg-0 ml-auto">
      <ul class="navbar-nav mr-auto ">
        {% if app.user %}
        <li class="nav-item dropdown">
          <div class="chip chip-lg aqua-gradient white-text nav-link dropdown-toggle" id="navbarDropdownMenuLink"
            role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"
            style="padding-right: 1rem;">
            <img src="../img/{{app.user.avatar}}" class="avatar avatar-mini" alt="Avatar de {{app.user.NameUser}}">
            Bienvenue {{app.user.NameUser}}
          </div>
          <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
            <a class="dropdown-item" href="{{ path('editProfil', {'id':app.user.id})  }}">Edit Profil</a>
            {% if app.user and is_granted('ROLE_ADMIN') %}
            <button class="dropdown-item " data-toggle="modal" data-target=".bd-example-modal-lg">Create projet</button>
            <a href="{{ path('createProfil') }}" class="dropdown-item">Create Profil</a>
            {% endif %}
            <a class="navbar-logout dropdown-item" href="{{ path('logout')}}" data-toggle="tooltip" title="Déconnexion">
              Déconnexion
            </a>
            <a class="dropdown-item" href="#">
              <div class="custom-control custom-switch">
                <input type="checkbox" class="custom-control-input" id="customSwitch1">
                <label class="custom-control-label" for="customSwitch1" name="dark_light"
                  onclick="toggleDarkLight()">Thème sombre</label>
              </div>
            </a>
          </div>
        </li>
        {% endif %}
      </ul>
    </form>
  </nav>
  {#  END NAVBAR #}
  <div class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header text-center">
          <h3>Nouveau Projet</h3>
          <button type="button" class="close btn-circle" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>

        <div class="container">
          {{ form_start(form) }}
          <div class="form-row">
            <div class="form-group col-md-6">
              {{ form_label(form.name_projet)}}
              {{ form_widget(form.name_projet, { 'attr': {'class': 'form-control', 'style': 'width: auto;'} })}}
            </div>
            <div class="form-group col-md-6">
              {{ form_label(form.name_domain)}}
              {{ form_widget(form.name_domain, { 'attr': {'class': 'form-control', 'style': 'width: auto;'} })}}
            </div>
          </div>
          <div class="form-row">
            <div class="form-group col-md-6">
              {{ form_label(form.company.name_company)}}
              {{ form_widget(form.company.name_company, { 'attr': {'class': 'form-control', 'style': 'width: auto;'} })}}
            </div>
            <div class="form-group col-md-6">
              {{ form_label(form.company.email_company)}}
              {{ form_widget(form.company.email_company, { 'attr': {'class': 'form-control', 'style': 'width: auto;'} })}}
            </div>
          </div>
          <div class="form-row">
            <div class="form-group col-md-6">
              {{ form_label(form.company.siret_company)}}
              {{ form_widget(form.company.siret_company, { 'attr': {'class': 'form-control', 'style': 'width: auto;'} })}}
            </div>
            <div class="form-group col-md-6">
              {{ form_label(form.company.phone_company)}}
              {{ form_widget(form.company.phone_company, { 'attr': {'class': 'form-control', 'style': 'width: auto;'} })}}
            </div>
          </div>
          <div class="form-group">
            {{ form_label(form.company.name_director)}}
            {{ form_widget(form.company.name_director, { 'attr': {'class': 'form-control', 'style': 'width: auto;'} })}}
          </div>

          <div class="form-row">
            <div class="form-group col-md-6">
              {{ form_label(form.img_projet)}}
              {{ form_widget(form.img_projet)}}
            </div>
            <div class="form-group col-md-6">
              {{ form_label(form.logo_projet)}}
              {{ form_widget(form.logo_projet)}}
            </div>
          </div>
          <div class="form-group col-6" style="padding-right: 0; padding-left: 0;">
            {{ form_label(form.doc_projet)}}
            {{ form_widget(form.doc_projet)}}
          </div>
          <div class="form-row">
            <div class="form-group col-md-6">
              {{ form_label(form.date_start)}}
              {{ form_widget(form.date_start)}}
            </div>
            <div class="form-group col-md-6">
              {{ form_label(form.date_end)}}
              {{ form_widget(form.date_end)}}
            </div>
          </div>
          <div class="form-group">
            {{ form_label(form.desc_projet)}}
            {{ form_widget(form.desc_projet, { 'attr': {'class': 'form-control'} })}}
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn aqua-gradient" style="border-radius: 40px;">Create</button>

        </div>
        {{ form_end(form) }}
      </div>
    </div>
  </div>
</header>
<main class="global">
  <hr>
  <div class="container">
    <h1 id="home">List des Projets :</h1>
  </div>
  <hr>

  <div class="container-fluid" style="text-align: -webkit-center;">
    <div class="row" id="home">
      {% for company in companys %}
      {% for projet in company.projets %}

      <div class="col-12 col-sm-6 col-md-4 col-lg-3" style="padding-bottom: 2em;">

        <div class="card card-cascade narrower" style="width: 18rem;">
          <div class="view view-cascade overlay">
            <img src="../img/{{projet.imgProjet}}" class="card-img-top" alt="#">
            <a href="#!">
              <div class="mask rgba-white-slight"></div>
            </a>
            <div class="card-body card-body-cascade text-center">
              <h5 class="card-title">{{ projet.nameProjet}}</h5>
              <button type="button" class="btn aqua-gradient" data-toggle="modal"
                data-target="#exampleModal{{ projet.id }}" aria-controls="exampleModal" style="border-radius: 40px;">
                Voir plus
              </button>
              <div class="row">
                {% for user in projet.assignedUsers %}
                <img src="../img/{{user.avatar}}" class="card-img-top avatar-mini" alt="#">
                {% endfor %}
              </div>
            </div>
          </div>
        </div>
      </div>


      <div class="modal fade" id="exampleModal{{ projet.Id}}" tabindex="-1" role="dialog"
        aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <div class="row">
                <div class="col">
                  <img src="../img/{{projet.logoProjet}}" style="width: 5em; height: 5em; border-radius: 50%;">
                </div>
                <div class="col">
                  <h5 class="modal-title" id="exampleModalLabel">{{ projet.nameProjet}}</h5>
                </div>


                <button type="button" class="close btn-circle" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>

                </button>
              </div>
            </div>

            <div class="modal-body" id="{{ projet.Id}}">
              <div class="row">
                <div class="col">
                  <p><u>Nom de la Société</u> : {{ company.NameCompany }}</p>
                </div>
                <div class="col">
                  <p><u>Nom du directeur</u> : {{ company.NameDirector }}</p>
                </div>
              </div>
              <div class="row">
                <div class="col">
                  <p><u>Siret de la Société</u> : {{ company.SiretCompany }}</p>
                </div>
                <div class="col">
                  <p><u>Téléphone</u> : {{ company.PhoneCompany }}</p>
                </div>
              </div>
              <div class="row">
                <div class="col">
                  <p><u>Email</u> : {{ company.EmailCompany }}</p>
                </div>
                <div class="col">
                </div>
              </div>
              <div class="row">
                <div class="col">
                  <p><u>Date de début du contrat</u> : {{ projet.dateStart|date('d/m/Y')}}</p>
                </div>
                <div class="col">
                  <p><u>Date de fin du contrat</u> : {{ projet.dateEnd|date('d/m/Y')}}</p>
                </div>
              </div>
              <img src="../img/{{projet.imgProjet}}" style="max-width: 40em; max-height: 40em;">
              <h5> <u>Description</u> : </h5>
              <p>{{ projet.descProjet}}</p>
              <div class="row">
                {% for user in projet.assignedUsers %}
                <img src="../img/{{user.avatar}}" class="card-img-top avatar-mini" alt="#">
                <p>{{user.NameUser}}</p>
                {% endfor %}
              </div>
              <div clas="col">
                <div class="input-group mb-3">

                  <select class="browser-default custom-select" id="inputGroupSelect01">
                    <option selected disabled value="-1">Choose...</option>
                    {% for user in users %}
                    <option value="{{user.id}}">{{user.id}}-{{user.UserName}}</option>
                    {% endfor %}
                  </select>
                </div>
              </div>
              <div class="col">
                <a class="btn aqua-gradient assign-projet" data-id="{{ projet.id }}" data-modalid="{{ projet.Id }}"
                  class="btn aqua-gradient" style="border-radius: 40px;">Assigned</a>
              </div>
            </div>


            <div class="modal-footer">
              <a href="{{ path('todolist', {'id':projet.id}) }}" class="btn aqua-gradient"
                style="border-radius: 40px;">todolist</a>
              {% if app.user and is_granted('ROLE_ADMIN') %}
              <a href="{{ path('edit', {'id':projet.id}) }}" class="btn aqua-gradient "
                style="border-radius: 40px;">Edit projet</a>
              <a href="{{ path('editCompany', {'id':company.id}) }}" class="btn aqua-gradient "
                style="border-radius: 40px;">Edit company</a>
              <a href="#" class="btn aqua-gradient delete-projet" data-id="{{ projet.id }}"
                style="border-radius: 40px;">Delete</a>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
      {% endfor %}


    </div>

    <div class="d-flex justify-content-center">
      <ul class="pagination pagination-circle pg-blue">
        <li class="page-item {% if page == 1 %}disabled{% endif %}">
          <a class="page-link" href="{{ path('create_projet', {'page': page - 1})}}">&laquo;</a>
        </li>
        {% for i in 1..pages %}
        <li class="page-item {% if page == i %}active{% endif %}">
          <a class="page-link" href="{{ path('create_projet', {'page': i})}}">{{ i }}</a>
        </li>
        {% endfor %}
        <li class="page-item {% if page == pages %}disabled{% endif %}">
          <a class="page-link" href="{{ path('create_projet', {'page': page + 1})}}">&raquo;</a>
        </li>
      </ul>
    </div>
  </div>




  <div class="bottom">
    <hr>
    <h1 id="home">List des contrats</h1>
    <hr>
    <div class="container">
      <table class="table table-striped table-bordered" id="example">
        <thead>
          <tr>
            <th scope="col">Nom client</th>
            <th scope="col">Nom projet</th>
            <th scope="col">Date debut contrat</th>
            <th scope="col">Date fin contrat</th>
            <th scope="col">Date de contact</th>
          </tr>
        </thead>
        <tbody>
          {% for company in companys %}
          {% for projet in company.projets %}
          <tr>
            <th scope="row">{{ company.NameCompany }}</th>
            <th scope="row">{{ projet.nameProjet }}</th>
            <td>{{ projet.dateStart|date('d/m/Y')}}</td>
            <td>{{ projet.dateEnd|date('d/m/Y')}}</td>
            <td>{{ projet.datecontact|date('d/m/Y')}}</td>
          </tr>
          {% endfor %}
          {% endfor %}
        </tbody>
      </table>
      <ul id="demo" class="pagination"></ul>

    </div>
  </div>


</main>
{% endblock %}
{% block javascripts %}


<script>
  function toggleDarkLight() {
    var body = document.getElementById("body");
    var currentClass = body.className;
    body.className = currentClass == "dark-mode" ? "light-mode" : "dark-mode";
    document.documentElement.classList.add('color-theme-in-transition')
    window.setTimeout(function () {
      document.documentElement.classList.remove('color-theme-in-transition')
    }, 1000)
  };
</script>

<script src="/js/mdb.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/assign.js"></script>
{% endblock %}